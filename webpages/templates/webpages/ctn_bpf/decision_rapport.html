{% extends './decision.html' %}
{% load static %}

{% block main_content %}
<div class=" mt-4 row col-12 pl-3" style='display:flex;justify-content:center;margin-top:10px;'>
	<div class="col-lg-4">
		<div> <b>Liste des Rapports</b> </div>
		<div> 
			<div class="p-3">
				<div> Rapports en attente</div>
				<div class="py-2">
					{% for rapport in operation.get_operation_details_invalid %}
					<div class="py-2" style="border-bottom:1px solid #aaa;">
						<a href="/decision/o/{{operation.id}}/{{rapport.id}}/" class="text-dangery"><i class="fas fa-file"></i>&nbsp;{{rapport}}</a>
					</div>
					{% endfor %}
				</div>
			</div>
			<div class="p-3">
				<div> Rapports valides </div>
				<div class="py-2">
					{% for rapport in operation.get_operation_details_valid %}
					<div class="py-2" style="border-bottom:1px solid #aaa;">
						<a href="#" class="text-success"> <i class="fas fa-file"></i>&nbsp; {{rapport}}</a>
					</div>
					{% endfor %}
				</div>
			</div>
		</div>
	</div>
	<div class="col-lg-8">
								<div class="col-lg-12 ">
									<div class="p-2">
										{% if actual_institution.default_options == True %}

										{% else %}
										{% for elt in operation_rapport.aggregate_values %}
										<div class="d-flex my-2">
											<div class="pr-2 ">{{elt.label}} : </div>
												{% if elt.type == 'file' %}
												{% if elt.value.m_file != None and elt.value.m_file != "" %}
													<div>
														<a href="{{elt.value.m_file.url}}"><i class="fas fa-file"></i>
														{{elt.value.m_file}}</a>
													</div>
												{% endif %}
												{% elif elt.type == 'image' %}
												{% if elt.value.m_file != None and elt.value.m_file != "" %}
												<div>
													<img src="{{elt.value.m_file.url}}" style="width:80px;height:80px;">
												</div>
												{% endif %}
												{% elif elt.type == 'choix' %}
												<div>
													{% for e in elt.extras_repported %}
														{% if e.state == '1' %}<div class="text-success d-flex"> <div><i class="fas fa-check"></i></div> <div class="value_liner pl-2">{{e.label}}</div> </div>
														{% else %}<div class="text-danger d-flex"> <div> <i class="fas fa-times">	</i> </div> <div class="value_liner pl-2">{{e.label}}</div> </div>
														{% endif %}
													{% endfor %}
												</div>Soumi
												{% else %}
												<div class="value_liner text-success">{{elt.value}}</div> 
												{% endif %}
											</div>
										{% endfor %}

										{% endif %}
										<div class="my-2"> Soumis le <span class="text-success"> {{operation_rapport.date_created}}</span></div>


										<div> Par <span class="text-success"> {{operation_rapport.personnel}} </span></div>
									</div>
										{% if operation_rapport.m_commentaire != None %}
										<div class="bg-light  p-3">
											<legend>Compte Rendu</legend>
	                      					<div class="">
	                      						{{operation_rapport.m_commentaire}}
	                      					</div>
                      					</div>
                      					{% endif %}									
									{% if operation.accountable.bd_user == user %}
									<div class="my-2">
										<div data-target="#validOperModal" data-operation="{{operation}}" data-personnel="{{operation.personnel}}" data-id="{{operation.id}}" data-toggle="modal" onclick="validerTache(this);" class="opera_valider btn btn-success"> Valider </div>
										<div data-target="#annulerOperModal" data-toggle="modal" data-id="{{operation.id}}" data-rapport="{% if operation.tech_rapports.first != None %}{{operation.tech_rapports.first.id}}{% endif %}" onclick="annulerTache(this)" class="btn btn-danger"> Rejeter </div>
									</div>
									{% endif %}
									{% if operation.consulted.bd_user == user %}
									<form method="POST" action="/consult_oper/">
										{% csrf_token %}
										<input type="hidden" name="operation_rapport" value="{{operation_rapport.id}}">
										<input type="hidden" name="operation" value="{{operation.id}}">
										<input type="hidden" name="nb_stars" id="nb_stars">
									<div> Donnez vos Avis ( sur 5 Etoiles )</div>
									<div class="starDiv d-flex my-2">
										<div>
											<i data-id="1" class="fas fa-star"></i>
										</div>

										<div>
											<i data-id="2" class="fas fa-star"></i>
										</div>
										<div>
											<i data-id="3" class="fas fa-star"></i>
										</div>
										<div>
											<i data-id="4" class="fas fa-star"></i>
										</div>
										<div>
											<i data-id="5" class="fas fa-star"></i>
										</div>
									</div>
									<div>
										<textarea class="form-control" name="observations"  rows="6"></textarea>
										<div class="my-3">
											<input type="submit" value="Enregistrer" class="btn btn-warning" name="">
										</div>
									</div>
									</form>
									{% endif %}
								</div>
	</div>
</div>
{% endblock %}